<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Sample of BrowserHistoryQueryStorage</title>
        <link
            rel="stylesheet"
            type="text/css"
            href="./common-assets/common.css"
        />
    </head>
    <body>
        <script
            type="text/javascript"
            src="../dist/main.dev.browser.js"
        ></script>

        <form id="values"></form>

        <script type="text/javascript">
            const {
                BrowserHistoryPathHashStorage,
                PrefixStorage,
                ObjectStorage,
            } = Everstorage;

            const defaultValue = { x: 10, y: 10 };
            const storage = new BrowserHistoryPathHashStorage(
                (urlPath) => {
                    const [_, x, y] = urlPath.split('/');
                    return { x, y };
                },
                ({ x, y }) => `/${x}/${y}`,
                defaultValue,
                { debounceInterval: 50 },
                new PrefixStorage(
                    new ObjectStorage(localStorage),
                    'BrowserHistoryPathHashStorage',
                ),
            );

            const inputElements = {};
            const formElement = document.getElementById(`values`);
            for (const [key, value] of Object.entries(defaultValue)) {
                const inputElement = document.createElement('INPUT');
                inputElement.type =
                    typeof value === 'number' ? 'number' : 'text';
                const pushValue = () => {
                    storage.pushValue({ [key]: inputElement.value });
                };
                inputElement.addEventListener('change', pushValue);
                inputElement.addEventListener('click', pushValue);
                formElement.appendChild(inputElement);
                inputElements[key] = inputElement;
            }

            storage.values.subscribe((values) => {
                console.log(`new values`, values);
                for (const [key, value] of Object.entries(values)) {
                    inputElements[key].value = value;
                }
            });
        </script>
    </body>
</html>
